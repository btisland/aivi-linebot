---
name: æŒ‡ä»¤è™•ç†å™¨èˆ‡è¨Šæ¯æ ¼å¼åŒ–å¯¦ä½œ
status: completed
created: 2025-12-09T09:13:21Z
updated: 2025-12-09T09:50:00Z
github: https://github.com/btisland/aivi-linebot/issues/6
depends_on: [3, 5]
parallel: false
conflicts_with: []
---

# Task: æŒ‡ä»¤è™•ç†å™¨èˆ‡è¨Šæ¯æ ¼å¼åŒ–å¯¦ä½œ

## Description
å¯¦ä½œ `/aivi` æŒ‡ä»¤è™•ç†å™¨ï¼Œè² è²¬æŒ‡ä»¤åŒ¹é…ã€å‘¼å«çˆ¬èŸ²æ¨¡çµ„ã€æ ¼å¼åŒ–è¨Šæ¯ï¼Œä¸¦é€é LINE Bot API å›è¦†ä½¿ç”¨è€…ã€‚æ•´åˆçˆ¬èŸ²æ¨¡çµ„èˆ‡ webhook æœå‹™ï¼Œå®Œæˆç«¯å°ç«¯çš„åŠŸèƒ½æµç¨‹ã€‚

## Acceptance Criteria
- [x] `src/handlers/command_handler.py` å·²å»ºç«‹
- [x] å¯¦ä½œ `handle_aivi_command(event)` å‡½å¼
- [x] å¯¦ä½œæŒ‡ä»¤åŒ¹é…é‚è¼¯ï¼ˆ`/aivi`ï¼Œä¸å€åˆ†å¤§å°å¯«ï¼‰
- [x] å¯¦ä½œè¨Šæ¯æ ¼å¼åŒ–å‡½å¼ `format_news_message(articles)`
- [x] æ•´åˆçˆ¬èŸ²æ¨¡çµ„ `scrape_aivi_news()`
- [x] ä½¿ç”¨ LINE Bot API å›è¦†è¨Šæ¯
- [x] éŒ¯èª¤è™•ç†ï¼šçˆ¬å–å¤±æ•—ã€ç„¡æ–‡ç« ã€API éŒ¯èª¤
- [x] åœ¨ `src/app.py` ä¸­æ•´åˆæŒ‡ä»¤è™•ç†å™¨

## Technical Details

### æŒ‡ä»¤è™•ç†å™¨æ¨¡çµ„

#### src/handlers/command_handler.py
```python
from linebot import LineBotApi
from linebot.models import TextSendMessage
from src.scrapers.aivi_scraper import scrape_aivi_news
import logging

logger = logging.getLogger(__name__)

async def handle_aivi_command(event, line_bot_api: LineBotApi):
    """è™•ç† /aivi æŒ‡ä»¤

    åƒæ•¸ï¼š
        event: LINE MessageEvent
        line_bot_api: LINE Bot API å¯¦ä¾‹
    """
    try:
        # å‘¼å«çˆ¬èŸ²æ¨¡çµ„
        articles = await scrape_aivi_news(max_articles=5)

        # æ ¼å¼åŒ–è¨Šæ¯
        message_text = format_news_message(articles)

        # å›è¦†è¨Šæ¯
        line_bot_api.reply_message(
            event.reply_token,
            TextSendMessage(text=message_text)
        )
        logger.info(f"æˆåŠŸå›è¦† {len(articles)} å‰‡æ–°è")

    except Exception as e:
        logger.error(f"è™•ç† /aivi æŒ‡ä»¤æ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")
        error_message = "âŒ æŠ±æ­‰ï¼Œç›®å‰ç„¡æ³•å–å¾—æ–°èã€‚è«‹ç¨å¾Œå†è©¦ã€‚"
        line_bot_api.reply_message(
            event.reply_token,
            TextSendMessage(text=error_message)
        )

def format_news_message(articles: list) -> str:
    """æ ¼å¼åŒ–æ–‡ç« æ¸…å–®ç‚º LINE è¨Šæ¯

    åƒæ•¸ï¼š
        articles: æ–‡ç« æ¸…å–®ï¼Œæ¯å€‹å…ƒç´ åŒ…å« title å’Œ url

    è¿”å›ï¼š
        æ ¼å¼åŒ–çš„è¨Šæ¯å­—ä¸²
    """
    if not articles:
        return "ğŸ“° AIVI æœ€æ–°æ–‡ç« \n\nç›®å‰æ²’æœ‰æ‰¾åˆ°æ–°æ–‡ç« "

    message = "ğŸ“° AIVI æœ€æ–°æ–‡ç« \n\n"

    for i, article in enumerate(articles[:5], 1):
        title = article.get('title', 'ç„¡æ¨™é¡Œ')
        url = article.get('url', '')
        message += f"{i}. {title}\n"
        message += f"   ğŸ”— {url}\n\n"

    return message.strip()
```

### æ•´åˆåˆ° src/app.py

```python
from src.handlers.command_handler import handle_aivi_command
import asyncio

@handler.add(MessageEvent, message=TextMessageContent)
def handle_message(event):
    """è™•ç†æ–‡å­—è¨Šæ¯äº‹ä»¶"""
    message_text = event.message.text.strip().lower()

    # æª¢æŸ¥æ˜¯å¦ç‚º /aivi æŒ‡ä»¤
    if message_text == "/aivi":
        # ä½¿ç”¨ asyncio åŸ·è¡ŒéåŒæ­¥æŒ‡ä»¤è™•ç†
        asyncio.run(handle_aivi_command(event, line_bot_api))
    else:
        # å…¶ä»–è¨Šæ¯ä¸è™•ç†
        pass
```

### è¨Šæ¯æ ¼å¼ç¯„ä¾‹

**æ­£å¸¸æƒ…æ³ï¼ˆæœ‰æ–‡ç« ï¼‰**ï¼š
```
ğŸ“° AIVI æœ€æ–°æ–‡ç« 

1. ğŸš€Nano Banana Proå…¨èƒ½å®æµ‹ï¼å¼ºå¾—ç¦»è°±ï¼
   ğŸ”— https://www.aivi.fyi/llms/introduce-Nano-Banana-Pro

2. AI Agent é–‹ç™¼æœ€ä½³å¯¦è¸
   ğŸ”— https://www.aivi.fyi/ai-agents/best-practices

3. å¦‚ä½•é¸æ“‡ LLM æ¨¡å‹
   ğŸ”— https://www.aivi.fyi/llms/model-selection
```

**ç„¡æ–‡ç« æƒ…æ³**ï¼š
```
ğŸ“° AIVI æœ€æ–°æ–‡ç« 

ç›®å‰æ²’æœ‰æ‰¾åˆ°æ–°æ–‡ç« 
```

**éŒ¯èª¤æƒ…æ³**ï¼š
```
âŒ æŠ±æ­‰ï¼Œç›®å‰ç„¡æ³•å–å¾—æ–°èã€‚è«‹ç¨å¾Œå†è©¦ã€‚
```

### éŒ¯èª¤è™•ç†é‚è¼¯

| éŒ¯èª¤æƒ…æ³ | è™•ç†æ–¹å¼ | å›è¦†è¨Šæ¯ |
|---------|---------|---------|
| çˆ¬èŸ²æ¨¡çµ„æ‹‹å‡ºç•°å¸¸ | æ•æ‰ç•°å¸¸ï¼Œè¨˜éŒ„æ—¥èªŒ | âŒ æŠ±æ­‰ï¼Œç›®å‰ç„¡æ³•å–å¾—æ–°èã€‚è«‹ç¨å¾Œå†è©¦ã€‚ |
| æ–‡ç« æ¸…å–®ç‚ºç©º | æ­£å¸¸è™•ç† | ç›®å‰æ²’æœ‰æ‰¾åˆ°æ–°æ–‡ç«  |
| LINE API å‘¼å«å¤±æ•— | è¨˜éŒ„éŒ¯èª¤ï¼Œä¸é‡è©¦ | ï¼ˆä½¿ç”¨è€…ä¸æœƒæ”¶åˆ°è¨Šæ¯ï¼‰ |

### æ•ˆèƒ½è€ƒé‡
- çˆ¬èŸ²æ“ä½œç‚ºéåŒæ­¥ï¼ˆasync/awaitï¼‰
- ç›®æ¨™å›æ‡‰æ™‚é–“ï¼š< 10 ç§’
- Timeout è¨­å®šï¼šHTTP è«‹æ±‚ 5 ç§’

## Dependencies
- [x] Task 002 å®Œæˆï¼ˆçˆ¬èŸ²æ¨¡çµ„å·²å¯¦ä½œï¼‰
- [x] Task 004 å®Œæˆï¼ˆWebhook æœå‹™å·²å»ºç«‹ï¼‰
- [x] LINE Bot API å¯ç”¨

## Effort Estimate
- Size: M
- Hours: 3
- Parallel: false

## Definition of Done
- [x] `src/handlers/command_handler.py` å·²å»ºç«‹
- [x] æŒ‡ä»¤è™•ç†é‚è¼¯å®Œæ•´å¯¦ä½œ
- [x] è¨Šæ¯æ ¼å¼åŒ–å‡½å¼å®Œæ•´å¯¦ä½œ
- [x] å·²æ•´åˆåˆ° `src/app.py`
- [x] éŒ¯èª¤è™•ç†é‚è¼¯å®Œæ•´
- [x] æœ¬æ©Ÿæ¸¬è©¦ï¼šæ ¼å¼åŒ–å‡½å¼æ¸¬è©¦é€šé
- [x] æ¸¬è©¦å¤§å°å¯«ï¼šæŒ‡ä»¤åŒ¹é…ä½¿ç”¨ `.lower()` è™•ç†
- [x] ç¨‹å¼ç¢¼åŒ…å«å®Œæ•´çš„ç¹é«”ä¸­æ–‡è¨»è§£
