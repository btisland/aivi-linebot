---
name: AIVI 網站爬蟲核心模組實作
status: open
created: 2025-12-09T09:13:21Z
updated: 2025-12-09T09:24:52Z
github: https://github.com/btisland/aivi-linebot/issues/3
depends_on: [2]
parallel: true
conflicts_with: []
---

# Task: AIVI 網站爬蟲核心模組實作

## Description
實作 AIVI 網站爬蟲模組，負責發送 HTTP 請求至 AIVI 首頁（https://www.aivi.fyi/），解析 HTML 結構，提取最新 5 則文章的標題與連結，並返回結構化資料。

## Acceptance Criteria
- [ ] `src/scrapers/aivi_scraper.py` 已建立
- [ ] 實作 `scrape_aivi_news(max_articles: int = 5)` 非同步函式
- [ ] 實作 `parse_articles(html: str, max_articles: int = 5)` 解析函式
- [ ] 使用 `httpx` 進行 HTTP 請求（timeout 5 秒，最多重試 2 次）
- [ ] 使用 `selectolax` 解析 HTML（選擇器：`h2.archive__item-title > a`）
- [ ] 處理相對路徑（加上 `https://www.aivi.fyi` 前綴）
- [ ] 錯誤處理：網路錯誤、解析錯誤、找不到文章
- [ ] 回傳格式：`List[Dict[str, str]]`，每個 dict 包含 `title` 和 `url`

## Technical Details

### 核心函式

#### 1. scrape_aivi_news
```python
async def scrape_aivi_news(max_articles: int = 5) -> List[Dict[str, str]]:
    """爬取 AIVI 最新文章

    參數：
        max_articles: 最多返回幾則文章（預設 5）

    返回：
        文章清單，每個元素包含 title 和 url

    異常：
        httpx.TimeoutException: 請求超時
        httpx.HTTPError: HTTP 錯誤
    """
```

#### 2. parse_articles
```python
def parse_articles(html: str, max_articles: int = 5) -> List[Dict[str, str]]:
    """解析 AIVI 首頁 HTML，提取文章資訊

    參數：
        html: AIVI 首頁的 HTML 內容
        max_articles: 最多返回幾則文章（預設 5）

    返回：
        文章清單，每個元素包含 title 和 url
    """
```

### HTML 結構參考
```html
<h2 class="archive__item-title no_toc" itemprop="headline">
  <a href="/llms/introduce-Nano-Banana-Pro" rel="permalink">
    🚀Nano Banana Pro全能实测！强得离谱！...
  </a>
</h2>
```

### 錯誤處理策略
- **Timeout**：5 秒 timeout，重試最多 2 次
- **HTTP Error**：記錄 HTTP 狀態碼，回傳空清單 `[]`
- **解析錯誤**：記錄警告「HTML 結構可能已變更」，回傳空清單 `[]`
- **找不到文章**：記錄警告，回傳空清單 `[]`

### 設定常數
```python
AIVI_BASE_URL = "https://www.aivi.fyi"
AIVI_HOMEPAGE_URL = "https://www.aivi.fyi/"
REQUEST_TIMEOUT = 5  # 秒
MAX_RETRIES = 2
CSS_SELECTOR = "h2.archive__item-title > a"
```

## Dependencies
- [ ] Task 001 完成（套件已安裝）
- [ ] httpx 套件可用
- [ ] selectolax 套件可用

## Effort Estimate
- Size: M
- Hours: 4
- Parallel: true

## Definition of Done
- [ ] `src/scrapers/aivi_scraper.py` 已實作
- [ ] 所有核心函式都有繁體中文 docstring
- [ ] 錯誤處理邏輯完整
- [ ] 程式碼符合 PEP 8 規範
- [ ] 本機測試：可手動執行並取得文章清單
- [ ] 日誌記錄完整（使用 Python logging 模組）
